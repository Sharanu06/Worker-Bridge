<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Worker Dashboard</title>
<link rel="stylesheet" href="styles.css">
<style>
/* Job cards */
.job-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 20px;
  padding: 30px;
}

.job-card {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  cursor: pointer;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  transition: transform 0.2s, box-shadow 0.2s;
}

.job-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(0,0,0,0.15);
}

.job-card h3 {
  color: #ff7a00;
  margin-bottom: 8px;
}

.job-card p {
  color: #444;
  font-size: 14px;
}

/* Job details modal */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.modal-content {
  background: #fff;
  border-radius: 12px;
  padding: 25px;
  width: 90%;
  max-width: 420px;
}

.modal-content h2 {
  color: #ff7a00;
}

.modal-content button {
  margin-top: 15px;
}
</style>
</head>

<body>

<nav class="navbar">
  <a href="index.html" class="logo">Worker <span>Bridge</span></a>
  <button class="btn small" onclick="logout()">Logout</button>
</nav>

<section class="page-header">
  <h1>Available Jobs</h1>
  <p>Select a job to view details</p>
</section>

<section class="job-grid" id="jobGrid"></section>

<!-- JOB DETAILS MODAL -->
<div class="modal" id="jobModal">
  <div class="modal-content">
    <h2 id="jobTitle"></h2>
    <p><strong>Work:</strong> <span id="jobWork"></span></p>
    <p><strong>Wage:</strong> ‚Çπ<span id="jobWage"></span> / day</p>
    <p><strong>Location:</strong> <span id="jobLocation"></span></p>
    <p><strong>Duration:</strong> <span id="jobDuration"></span></p>
   <button class="btn primary" onclick="acceptJob()">Accept Job</button>
   <button class="btn secondary" onclick="closeModal()">Cancel</button>

  </div>
</div>

<script>
// ================= AUTH CHECK =================
const user = JSON.parse(localStorage.getItem("currentUser"));
if (!user || user.role !== "worker") {
  window.location.href = "login.html";
}

// ================= INIT JOB DATA =================
if (!localStorage.getItem("jobs")) {
  localStorage.setItem("jobs", JSON.stringify([
    {
      id: 1,
      title: "Electrician Needed",
      work: "House wiring and switch fixing",
      wage: 800,
      location: "Hubli",
      duration: "1 day",
      provider: "provider1@gmail.com",
      status: "open"
    },
    {
      id: 2,
      title: "Construction Labour",
      work: "Brick lifting and site work",
      wage: 600,
      location: "Dharwad",
      duration: "3 days",
      provider: "provider2@gmail.com",
      status: "open"
    },
    {
      id: 3,
      title: "Plumber Required",
      work: "Bathroom pipe repair",
      wage: 900,
      location: "Belgaum",
      duration: "1 day",
      provider: "provider3@gmail.com",
      status: "open"
    }
  ]));
}

let jobs = JSON.parse(localStorage.getItem("jobs"));
const jobGrid = document.getElementById("jobGrid");

// ================= RENDER JOBS =================
function renderJobs() {
  jobGrid.innerHTML = "";

  const openJobs = jobs.filter(j => j.status === "open");

  if (openJobs.length === 0) {
    jobGrid.innerHTML = "<p>No available jobs right now.</p>";
    return;
  }

  openJobs.forEach(job => {
    const card = document.createElement("div");
    card.className = "job-card";
    card.innerHTML = `
      <h3>${job.title}</h3>
      <p>üìç ${job.location}</p>
      <p>üí∞ ‚Çπ${job.wage} / day</p>
      <button class="btn primary">View & Accept</button>
    `;
    card.querySelector("button").onclick = () => openJob(job.id);
    jobGrid.appendChild(card);
  });
}

renderJobs();

// ================= MODAL =================
let selectedJob = null;

function openJob(id) {
  selectedJob = jobs.find(j => j.id === id);

  document.getElementById("jobTitle").textContent = selectedJob.title;
  document.getElementById("jobWork").textContent = selectedJob.work;
  document.getElementById("jobWage").textContent = selectedJob.wage;
  document.getElementById("jobLocation").textContent = selectedJob.location;
  document.getElementById("jobDuration").textContent = selectedJob.duration;

  document.getElementById("jobModal").style.display = "flex";
}

// ================= ACCEPT JOB =================
function acceptJob() {
  jobs = jobs.map(job =>
    job.id === selectedJob.id
      ? { ...job, status: "accepted", acceptedBy: user.email }
      : job
  );

  localStorage.setItem("jobs", JSON.stringify(jobs));

  const notifications =
    JSON.parse(localStorage.getItem("notifications")) || [];

  notifications.push({
    provider: selectedJob.provider,
    message: `Job "${selectedJob.title}" accepted by ${user.name}`,
    time: new Date().toLocaleString()
  });

  localStorage.setItem("notifications", JSON.stringify(notifications));

  alert("‚úÖ Job accepted successfully!");

  closeModal();
  renderJobs();
}

// ================= CLOSE MODAL =================
function closeModal() {
  document.getElementById("jobModal").style.display = "none";
}

// ================= LOGOUT =================
function logout() {
  localStorage.removeItem("currentUser");
  window.location.href = "login.html";
}
</script>
</body>
</html>
